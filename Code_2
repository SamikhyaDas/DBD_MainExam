import streamlit as st
from textblob import TextBlob
import pandas as pd
from collections import Counter
import re

st.set_page_config(page_title="Customer Feedback Analyzer", layout="centered")
st.title("ğŸ§  Customer Feedback Analyzer")
st.markdown("Paste or upload customer feedback below to analyze sentiment and extract keywords.")

uploaded_file = st.file_uploader("ğŸ“ Upload CSV file with a 'feedback' column", type=["csv"])
manual_input = st.text_area("âœï¸ Or manually enter feedback (one per line):", height=200)

feedback_list = []

# Handle file upload
if uploaded_file is not None:
    try:
        df = pd.read_csv(uploaded_file)
        if "feedback" in df.columns:
            feedback_list = df["feedback"].dropna().astype(str).tolist()
        else:
            st.error("CSV must contain a 'feedback' column.")
    except Exception as e:
        st.error(f"Error reading file: {e}")

elif manual_input.strip() != "":
    feedback_list = [line.strip() for line in manual_input.split("\n") if line.strip()]

# Analysis
if st.button("ğŸ” Analyze Feedback") and feedback_list:
    sentiments = []
    all_words = []

    for feedback in feedback_list:
        blob = TextBlob(feedback)
        polarity = blob.sentiment.polarity
        if polarity > 0.1:
            sentiment = "ğŸŸ¢ Positive"
        elif polarity < -0.1:
            sentiment = "ğŸ”´ Negative"
        else:
            sentiment = "ğŸŸ¡ Neutral"
        sentiments.append((sentiment, feedback))

        words = re.findall(r'\b\w+\b', feedback.lower())
        all_words.extend(words)

    sentiment_counts = Counter([s[0] for s in sentiments])
    top_words = Counter(all_words).most_common(10)

    st.subheader("ğŸ“Š Sentiment Summary")
    st.write(f"ğŸŸ¢ Positive: {sentiment_counts['ğŸŸ¢ Positive']}")
    st.write(f"ğŸŸ¡ Neutral: {sentiment_counts['ğŸŸ¡ Neutral']}")
    st.write(f"ğŸ”´ Negative: {sentiment_counts['ğŸ”´ Negative']}")

    st.subheader("ğŸ”‘ Top Keywords")
    for word, freq in top_words:
        st.write(f"â€¢ {word}: {freq}")

    st.subheader("ğŸ“‹ Detailed Feedback Analysis")
    for sentiment, feedback in sentiments:
        st.markdown(f"**{sentiment}** â€” {feedback}")

elif st.button("ğŸ” Analyze Feedback") and not feedback_list:
    st.warning("Please upload a file or enter some feedback first.")
